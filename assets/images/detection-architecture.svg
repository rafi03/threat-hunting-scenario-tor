<svg viewBox="0 0 900 700" xmlns="http://www.w3.org/2000/svg">
  <!-- Background -->
  <rect width="900" height="700" fill="white"/>
  
  <!-- Title -->
  <text x="450" y="35" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="24" font-weight="600" fill="#323130">Threat Detection Architecture</text>
  
  <!-- Data Collection Layer Header -->
  <rect x="50" y="65" width="800" height="2" fill="#e1dfdd"/>
  <text x="60" y="90" font-family="Segoe UI, Arial, sans-serif" font-size="16" font-weight="600" fill="#605e5c">DATA COLLECTION LAYER</text>
  
  <!-- DeviceFileEvents Database -->
  <g id="fileevents">
    <ellipse cx="200" cy="130" rx="60" ry="12" fill="#0b6a0b"/>
    <rect x="140" y="130" width="120" height="50" fill="#107c10" rx="3"/>
    <ellipse cx="200" cy="130" rx="60" ry="12" fill="#13a10e"/>
    <ellipse cx="200" cy="140" rx="60" ry="12" fill="#0b6a0b"/>
    <ellipse cx="200" cy="150" rx="60" ry="12" fill="#13a10e"/>
    <ellipse cx="200" cy="160" rx="60" ry="12" fill="#0b6a0b"/>
    <ellipse cx="200" cy="170" rx="60" ry="12" fill="#13a10e"/>
    <ellipse cx="200" cy="180" rx="60" ry="12" fill="#107c10"/>
    <text x="200" y="205" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="14" font-weight="500" fill="#323130">DeviceFileEvents</text>
  </g>
  
  <!-- DeviceProcessEvents Database -->
  <g id="processevents">
    <ellipse cx="450" cy="130" rx="60" ry="12" fill="#8a4400"/>
    <rect x="390" y="130" width="120" height="50" fill="#ca5010" rx="3"/>
    <ellipse cx="450" cy="130" rx="60" ry="12" fill="#ff8c00"/>
    <ellipse cx="450" cy="140" rx="60" ry="12" fill="#8a4400"/>
    <ellipse cx="450" cy="150" rx="60" ry="12" fill="#ff8c00"/>
    <ellipse cx="450" cy="160" rx="60" ry="12" fill="#8a4400"/>
    <ellipse cx="450" cy="170" rx="60" ry="12" fill="#ff8c00"/>
    <ellipse cx="450" cy="180" rx="60" ry="12" fill="#ca5010"/>
    <text x="450" y="205" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="14" font-weight="500" fill="#323130">DeviceProcessEvents</text>
  </g>
  
  <!-- DeviceNetworkEvents Database -->
  <g id="networkevents">
    <ellipse cx="700" cy="130" rx="60" ry="12" fill="#a72d2d"/>
    <rect x="640" y="130" width="120" height="50" fill="#d13438" rx="3"/>
    <ellipse cx="700" cy="130" rx="60" ry="12" fill="#ff4b4b"/>
    <ellipse cx="700" cy="140" rx="60" ry="12" fill="#a72d2d"/>
    <ellipse cx="700" cy="150" rx="60" ry="12" fill="#ff4b4b"/>
    <ellipse cx="700" cy="160" rx="60" ry="12" fill="#a72d2d"/>
    <ellipse cx="700" cy="170" rx="60" ry="12" fill="#ff4b4b"/>
    <ellipse cx="700" cy="180" rx="60" ry="12" fill="#d13438"/>
    <text x="700" y="205" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="14" font-weight="500" fill="#323130">DeviceNetworkEvents</text>
  </g>
  
  <!-- Detection Layer Header -->
  <rect x="50" y="245" width="800" height="2" fill="#e1dfdd"/>
  <text x="60" y="270" font-family="Segoe UI, Arial, sans-serif" font-size="16" font-weight="600" fill="#605e5c">DETECTION LAYER</text>
  
  <!-- Central Workstation -->
  <g id="workstation">
    <rect x="380" y="300" width="140" height="100" fill="#0078d4" rx="12"/>
    <rect x="395" y="315" width="110" height="70" fill="#106ebe" rx="8"/>
    <rect x="405" y="325" width="90" height="50" fill="#005a9e" rx="4"/>
    <circle cx="420" cy="340" r="4" fill="#ffffff"/>
    <rect x="435" y="335" width="50" height="3" fill="#ffffff" rx="1"/>
    <rect x="435" y="342" width="40" height="3" fill="#ffffff" rx="1"/>
    <rect x="435" y="349" width="45" height="3" fill="#ffffff" rx="1"/>
    <rect x="435" y="356" width="35" height="3" fill="#ffffff" rx="1"/>
    <text x="450" y="425" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="16" font-weight="600" fill="#323130">rafi-win</text>
    <text x="450" y="445" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="14" fill="#605e5c">Windows 10 Workstation</text>
  </g>
  
  <!-- Microsoft Defender -->
  <g id="defender">
    <rect x="100" y="300" width="120" height="100" fill="#0078d4" rx="12"/>
    <!-- Clean shield shape -->
    <path d="M160 320 L145 325 L145 350 C145 365 160 375 160 375 C160 375 175 365 175 350 L175 325 Z" fill="#ffffff"/>
    <!-- Shield inner line -->
    <path d="M160 325 L150 328 L150 348 C150 360 160 368 160 368 C160 368 170 360 170 348 L170 328 Z" fill="#f3f2f1"/>
    <text x="160" y="425" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="14" font-weight="600" fill="#323130">Microsoft Defender</text>
  </g>
  
  <!-- KQL Query Box -->
  <g id="kql">
    <rect x="680" y="300" width="180" height="100" fill="#f8f8f8" stroke="#d2d0ce" stroke-width="2" rx="8"/>
    <rect x="690" y="310" width="160" height="20" fill="#0078d4" rx="4"/>
    <text x="770" y="325" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="12" font-weight="600" fill="#ffffff">KQL Query Console</text>
    <text x="695" y="350" font-family="Consolas, monospace" font-size="11" fill="#323130">DeviceProcessEvents</text>
    <text x="695" y="365" font-family="Consolas, monospace" font-size="11" fill="#323130">| where ProcessCommandLine</text>
    <text x="695" y="380" font-family="Consolas, monospace" font-size="11" fill="#323130">  contains "powershell"</text>
    <text x="695" y="395" font-family="Consolas, monospace" font-size="11" fill="#605e5c">| project Timestamp...</text>
    <text x="770" y="425" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="14" font-weight="600" fill="#323130">Advanced Hunting</text>
  </g>
  
  <!-- Response Layer Header -->
  <rect x="50" y="475" width="800" height="2" fill="#e1dfdd"/>
  <text x="60" y="500" font-family="Segoe UI, Arial, sans-serif" font-size="16" font-weight="600" fill="#605e5c">RESPONSE LAYER</text>
  
  <!-- Isolate Device -->
  <g id="isolate">
    <rect x="150" y="530" width="120" height="80" fill="#d13438" rx="12"/>
    <circle cx="210" cy="560" r="18" fill="none" stroke="#ffffff" stroke-width="4"/>
    <path d="M198 548 L222 572 M222 548 L198 572" stroke="#ffffff" stroke-width="4"/>
    <rect x="195" y="575" width="30" height="15" fill="#ffffff" rx="2"/>
    <text x="210" y="630" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="14" font-weight="600" fill="#323130">Isolate Device</text>
    <text x="210" y="650" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="12" fill="#605e5c">Network Isolation</text>
  </g>
  
  <!-- Analyze Timeline -->
  <g id="timeline">
    <rect x="390" y="530" width="120" height="80" fill="#0078d4" rx="12"/>
    <circle cx="450" cy="570" r="25" fill="none" stroke="#ffffff" stroke-width="4"/>
    <path d="M450 550 L450 570 L465 585" stroke="#ffffff" stroke-width="4" fill="none" stroke-linecap="round"/>
    <circle cx="450" cy="570" r="3" fill="#ffffff"/>
    <text x="450" y="630" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="14" font-weight="600" fill="#323130">Analyze Timeline</text>
    <text x="450" y="650" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="12" fill="#605e5c">Event Analysis</text>
  </g>
  
  <!-- Generate Report -->
  <g id="report">
    <rect x="630" y="530" width="120" height="80" fill="#107c10" rx="12"/>
    <rect x="670" y="550" width="40" height="50" fill="none" stroke="#ffffff" stroke-width="3" rx="4"/>
    <path d="M675 560 L705 560 M675 567 L700 567 M675 574 L695 574 M675 581 L702 581 M675 588 L698 588" stroke="#ffffff" stroke-width="2"/>
    <text x="690" y="630" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="14" font-weight="600" fill="#323130">Generate Report</text>
    <text x="690" y="650" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="12" fill="#605e5c">Incident Documentation</text>
  </g>
  
  <!-- Data flow arrows - FROM databases TO workstation -->
  <path d="M200 215 L420 290" stroke="#8a8886" stroke-width="3" stroke-dasharray="8,4" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M450 215 L450 290" stroke="#8a8886" stroke-width="3" stroke-dasharray="8,4" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M700 215 L480 290" stroke="#8a8886" stroke-width="3" stroke-dasharray="8,4" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- Detection layer connections -->
  <path d="M220 350 L370 350" stroke="#0078d4" stroke-width="3" fill="none" marker-end="url(#blueArrow)" marker-start="url(#blueArrow)"/>
  <path d="M530 350 L670 350" stroke="#0078d4" stroke-width="3" fill="none" marker-end="url(#blueArrow)" marker-start="url(#blueArrow)"/>
  
  <!-- Response arrows - FROM workstation TO response actions -->
  <path d="M420 450 L230 520" stroke="#8a8886" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M450 450 L450 520" stroke="#8a8886" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M480 450 L670 520" stroke="#8a8886" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
  

  
  <!-- Arrow marker definitions -->
  <defs>
    <marker id="arrowhead" markerWidth="12" markerHeight="8" refX="11" refY="4" orient="auto" markerUnits="strokeWidth">
      <polygon points="0 0, 12 4, 0 8" fill="#8a8886"/>
    </marker>
    <marker id="blueArrow" markerWidth="12" markerHeight="8" refX="11" refY="4" orient="auto" markerUnits="strokeWidth">
      <polygon points="0 0, 12 4, 0 8" fill="#0078d4"/>
    </marker>
  </defs>
</svg>